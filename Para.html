<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>This Week's Parasha</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        h1 {
            color: #333;
        }
        #parasha {
            font-size: 24px;
            font-weight: bold;
            margin-top: 20px;
        }
        #hebrew-text {
            font-family: 'SBL Hebrew', 'Taamey Frank CLM', 'Times New Roman', serif;
            font-size: 20px;
            direction: rtl;
            margin-top: 20px;
            white-space: pre-wrap;
        }
        #read-aloud {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>This Week's Parasha</h1>
    <div id="parasha">Loading Parasha...</div>
    <div id="hebrew-text"></div>
    <button id="read-aloud" disabled>Read Aloud</button>

    <script>
        // Function to fetch this week's Parasha
        async function fetchParasha() {
            const hebcalApiUrl = "https://www.hebcal.com/shabbat?cfg=json&geonameid=281184&m=50";

            try {
                // Fetch Parasha data from Hebcal
                const response = await fetch(hebcalApiUrl);
                const data = await response.json();

                // Find the Parasha in the response
                const parashaItem = data.items.find(item => item.category === "parashat");
                if (parashaItem) {
                    const parashaName = parashaItem.hebrew;
                    const parashaRef = parashaItem.title; // English name for Sefaria API

                    // Display the Parasha name
                    document.getElementById("parasha").textContent = parashaName;

                    // Fetch and display the Hebrew text from Sefaria
                    const parashaText = await fetchParashaText(parashaRef);
                    document.getElementById("hebrew-text").textContent = parashaText || "Hebrew text not available.";

                    // Enable the "Read Aloud" button
                    document.getElementById("read-aloud").disabled = false;
                } else {
                    document.getElementById("parasha").textContent = "No Parasha found for this week.";
                }
            } catch (error) {
                console.error("Error fetching Parasha:", error);
                document.getElementById("parasha").textContent = "Failed to load Parasha.";
            }
        }

        // Function to fetch Hebrew text for the Parasha from Sefaria API
        async function fetchParashaText(parashaRef) {
            const sefariaApiUrl = `https://www.sefaria.org/api/texts/${parashaRef}`;

            try {
                const response = await fetch(sefariaApiUrl);
                const data = await response.json();

                // Extract and format the Hebrew text
                if (data.he && Array.isArray(data.he)) {
                    return data.he.join("\n"); // Join verses with newlines
                }
            } catch (error) {
                console.error("Error fetching Parasha text:", error);
            }
            return null;
        }

        // Function to read the Hebrew text aloud
        function readAloud() {
            const hebrewText = document.getElementById("hebrew-text").textContent;
            if (hebrewText && window.speechSynthesis) {
                const utterance = new SpeechSynthesisUtterance(hebrewText);
                utterance.lang = "he-IL"; // Set language to Hebrew
                utterance.rate = 0.9; // Adjust speech rate (0.1 to 10)
                window.speechSynthesis.speak(utterance);
            } else {
                alert("Text-to-speech is not supported in your browser.");
            }
        }

        // Add event listener to the "Read Aloud" button
        document.getElementById("read-aloud").addEventListener("click", readAloud);

        // Fetch and display the Parasha on page load
        fetchParasha();
    </script>
</body>
</html>
